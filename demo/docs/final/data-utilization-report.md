# NASA 우주 거주지 평가 시스템 - 데이터 활용 및 작동 원리

## How we used the data

본 프로젝트의 모든 핵심 데이터는 제공된 두 편의 NASA 관련 논문을 기반으로 구축되었습니다.

### 1. 모듈 정의 및 최소 요구 조건 데이터

**활용 논문**: "Defining the Required Net Habitable Volume for Long-Duration Exploration Missions" (Stromgren et al., 2020)

#### 18개 필수 모듈 선정
논문의 Table 16 (Combined Functional Spaces)에 명시된 18개의 기능들을 시뮬레이션의 기본 모듈로 그대로 채택했습니다. 이를 통해 사용자는 실제 장기 탐사 임무에서 요구되는 모든 필수 기능을 고려하여 설계하게 됩니다. 예를 들어 Food Preparation, Exercise Equipment, Sleep Quarters, Medical Care, Laboratory 등 우주 비행사들의 생활과 임무 수행에 반드시 필요한 공간들이 포함됩니다.

#### 모듈별 최소 부피 설정
각 모듈의 최소 부피 값을 논문에서 직접 추출하여 사용자가 모듈 크기를 정할 때의 기본 데이터로 제공했습니다. 예를 들어 'Food Preparation'은 4.35 m³, 'Exercise Equipment'는 6.12 m³ 등 논문에서 4인 승무원 기준으로 계산된 최소 요구 부피를 그대로 데이터베이스에 저장하여 활용합니다.

#### 최소 NHV 기준값 설정
평가 시스템의 기본 통과(Pass/Fail) 조건은 18개 모든 개별 모듈이 각각의 최소 요구 부피를 충족하는지를 검사하는 방식입니다. 논문에 명시된 각 기능 공간의 최소 NHV 기준값(예: 'Food Preparation' ≥ 4.35 m³)을 절대 기준으로 설정하여, 단 하나의 모듈이라도 이 기준에 미달하면 해당 설계는 실패로 간주됩니다. 이는 모든 필수 기능이 최소한의 공간을 보장받도록 하는 더 엄격하고 현실적인 검증 방법입니다.

---

### 2. 평가 시스템의 이론적 프레임워크

**활용 논문**: "A Tool for Automated Design and Evaluation of Habitat Interior Layouts" (Simon & Wilhite, 2014)

#### 평가 시스템 철학 도입
H.E.R.A.의 점수 시스템은 이 논문에서 제안하는 '레이아웃의 효율성을 정량화하는 다목적 가치 함수' 개념을 직접적으로 구현한 결과물입니다. 논문은 단순히 공간 배치의 물리적 조건만이 아니라, 승무원의 심리적 안정감, 업무 효율성, 공간 활용도 등 다양한 측면을 종합적으로 평가해야 한다는 철학을 제시했고, 이를 세 가지 핵심 평가 항목(공간 활용도, 쾌적성, 효율성)으로 구체화했습니다.

#### '쾌적성' 평가 근거 마련
논문의 핵심 평가 기준인 "Separation for Privacy" 및 "Separation for Noise" 개념에 착안하여, 태그 기반 거리 계산 평가 방식을 개발했습니다. 논문은 복잡한 기능 관계 매트릭스를 통해 어떤 공간들이 서로 가까워야 하고 멀리 떨어져야 하는지를 분석했는데, 이를 사용자가 직관적으로 이해할 수 있는 태그 시스템으로 단순화했습니다. 예를 들어 'Noise Generating' 태그가 붙은 운동 기구 공간과 'Quiet Required' 태그가 붙은 수면 공간 사이의 거리를 계산하여 점수를 부여합니다.

논문에서 제시한 R·D(Range-Distance) 분석 기법을 직접 적용했습니다. 소음원으로부터의 거리에 따라 소음이 감쇠되는 정도를 수학적으로 모델링하여(감쇠 함수: 1/(1 + 0.3×거리)), 조용한 공간이 얼마나 많은 소음에 노출되는지를 정량화합니다. 또한 사생활 보호를 위해 개인 공간(Private Space)과 공용 공간(Common Space) 간의 최소 거리를 평가하며, 청결 구역(Clean Zone)과 오염 구역(Contamination Zone)의 분리도 같은 원리로 평가합니다.

#### '공간 활용도' 평가 근거 마련
논문에서 강조하는 "Unusable Volume(사용 불가 공간)"을 최소화하는 개념을 바탕으로, '총 NHV / 총 가압 부피'라는 공식을 통해 공간 활용도를 평가합니다. 이는 한정된 공간을 얼마나 낭비 없이 알차게 사용했는지를 측정하는 핵심 지표가 됩니다. 70~77.5%를 최적 구간으로 설정하여, 너무 낮으면 공간 낭비로, 너무 높으면 과밀 설계로 간주합니다.

동시에 Stromgren 논문의 NHV 데이터를 활용하여 각 모듈이 최소 요구량 대비 얼마나 효율적으로 설계되었는지도 평가합니다. 최소 요구량의 1.0~1.35배 범위 내에서 설계하면 만점을 받고, 그보다 과도하게 크면 공간 낭비로 감점됩니다.

---

### 3. RAG 시스템을 위한 논문 데이터 벡터화

**활용 논문**: "Defining the Required Net Habitable Volume..." (Stromgren et al., 2020) 및 "A Tool for Automated Design and Evaluation..." (Simon & Wilhite, 2014) 전문

#### PDF 기반 벡터 데이터베이스 구축
두 편의 논문 전체를 AI가 이해하고 활용할 수 있도록 벡터 데이터베이스로 변환했습니다. PDF 파일에서 텍스트를 페이지별로 추출한 후, 최대 512 토큰 단위의 청크로 분할합니다. 문단과 문장 경계를 보존하며, 인접한 청크 간에는 50 토큰의 오버랩을 두어 문맥의 연속성을 유지합니다. 각 청크는 nomic-embed-text 모델을 통해 수치 벡터(임베딩)로 변환되며, 이렇게 생성된 수백 개의 벡터는 H2 데이터베이스에 영구 저장되고 동시에 메모리 인덱스에 로드되어 빠른 검색이 가능하도록 합니다.

#### 벡터 검색 기반 지능형 평가 및 챗봇
사용자가 Advanced 모드로 평가를 요청하거나 챗봇에 질문하면, 시스템은 해당 질문을 동일한 임베딩 모델로 벡터화한 후 코사인 유사도를 계산하여 가장 관련성 높은 논문 청크들을 검색합니다. Advanced 모드에서는 미션 프로필과 거주지 정보를 포함한 자동 생성 쿼리로 논문 근거를 찾아 점수 보너스와 피드백에 반영하고, 챗봇 모드에서는 사용자의 자유로운 질문에 대해 검색된 논문 내용을 LLM에 전달하여 출처가 명확한 답변을 생성합니다. 모든 응답에는 참조한 논문의 파일명과 페이지 번호가 포함되어 사용자가 원본 출처를 확인할 수 있습니다.

---

## How it works

### 1. Basic 평가 모드 - 정적 논문 기반 평가

#### 설계 제출
사용자가 3D 공간에 18개 모듈 배치를 완료하면, 각 모듈의 위치(x, y, z 좌표), 크기(폭, 높이, 깊이), 회전값(x, y, z축 회전각) 등의 정보가 JSON 형식으로 API를 통해 평가 서버로 전송됩니다. 거주지의 전체 크기 정보도 함께 전달됩니다.

#### 1단계: 기본 제약 조건 검증
서버는 먼저 네 가지 필수 조건을 검사합니다. 첫째, 18개 모듈이 모두 사용되었는지 확인합니다. 둘째, 각 모듈의 8개 꼭짓점을 회전 변환 행렬을 적용하여 계산한 후, 어떤 모듈의 꼭짓점도 다른 모듈 내부에 위치하지 않는지 검사하여 겹침을 방지합니다. 셋째, 모든 모듈의 꼭짓점이 거주지 경계 내부에 있는지 확인합니다. 넷째, Stromgren 논문의 Table 16에서 추출한 최소 NHV 값과 사용자가 설정한 모듈 크기를 비교하여, 18개 모든 모듈이 최소 요구 부피를 충족하는지 검증합니다. 하나라도 조건을 위반하면 평가는 즉시 실패하며 100점 패널티가 부과됩니다.

#### 2단계: 공간 활용도 점수 계산
제약 조건을 통과하면 세 가지 핵심 점수를 계산합니다. 먼저 공간 활용도는 두 가지 하위 점수의 평균입니다. 전체 공간 활용률은 18개 모듈의 NHV 합계를 거주지 전체 부피로 나눈 비율로 계산하며, 70~77.5% 구간에서 만점을 받습니다. NHV 적정성 점수는 각 모듈이 최소 요구량의 몇 배인지 계산하여, 1.0~1.35배 범위 내에 있으면 만점, 그 이상이면 감점합니다. 두 점수를 50:50으로 평균내고, 전체 종합 점수의 40% 가중치를 적용합니다.

#### 3단계: 쾌적성 점수 계산
쾌적성은 세 가지 분리 점수의 평균입니다. 소음 분리는 'Noise Generating' 태그 모듈들과 'Quiet Required' 태그 모듈들 간의 모든 거리를 계산하고, Simon & Wilhite 논문의 감쇠 함수를 적용하여 조용한 공간이 받는 총 소음 노출도를 산출합니다. 노출도가 낮을수록 높은 점수를 받습니다. 사생활 보호는 'Private Space'와 'Common Space' 간 최소 거리를 계산하여, 거주지 크기의 1/3 이상 떨어져 있으면 만점을 줍니다. 청결 구역 분리도 같은 방식으로 'Clean Zone'과 'Contamination Zone' 간 거리를 평가합니다. 세 점수를 평균내고 전체의 30% 가중치를 적용합니다.

#### 4단계: 효율성 점수 계산
'Work Space' 태그가 붙은 모듈들끼리의 평균 거리를 계산합니다. 작업 공간들이 너무 가까우면(2m 미만) 간섭이 발생할 수 있고, 너무 멀면(거주지 대각선의 70% 초과) 이동 시간이 낭비됩니다. 적정 범위 내에 배치되면 높은 점수를 받으며, 전체의 30% 가중치를 적용합니다.

#### 5단계: 피드백 생성
각 항목의 점수에 따라 자동으로 피드백 메시지를 생성합니다. 공간 활용도가 85점 이상이면 "Excellent space utilization" 같은 강점 피드백을, 쾌적성이 60점 미만이면 "Place noise-generating modules further apart" 같은 개선점 피드백을 추가합니다. 최종적으로 점수, 검증 결과, 피드백을 JSON으로 반환합니다.

---

### 2. Advanced 평가 모드 - RAG 기반 동적 보정

#### 기본 평가 수행
Advanced 모드는 먼저 Basic 모드와 동일한 평가를 수행합니다. 사용자가 미션 프로필(MARS 또는 LUNAR)을 선택하면 추가 처리가 시작됩니다.

#### 미션별 가중치 재조정
화성 미션은 장기 체류 특성상 공간 효율성(45%)과 쾌적성(35%)을 강조하고 효율성(20%)은 낮춥니다. 반대로 달 미션은 단기 운영과 빈번한 EVA 작업 때문에 효율성(45%)을 가장 높이고 공간(30%)과 쾌적성(25%)을 낮춥니다. 이미 계산된 세 가지 점수에 새로운 가중치를 적용하여 미션별로 최적화된 종합 점수를 산출합니다.

#### RAG 기반 동적 보너스 계산
시스템은 자동으로 RAG 시스템에 쿼리를 보냅니다. 예를 들어 화성 미션이면 "Space habitat layout evaluation for MARS mission. Habitat dimensions: 20x8x4m. Module count: 18. What are the key considerations?"라는 질문을 생성합니다. 벡터 데이터베이스에서 가장 유사한 논문 청크 2~3개를 검색하고, 해당 내용을 LLM에 전달하여 답변을 받습니다.

받은 답변 텍스트에서 특정 키워드를 감지하여 보너스를 적용합니다. 화성 미션에서 "privacy"와 "long-duration"이 함께 언급되면 쾌적성에 +5점, "eva"와 "operations"가 언급되면 달 미션 효율성에 +8점을 부여하는 식입니다. 이렇게 논문 데이터가 실시간으로 평가에 반영되어, 정적 알고리즘만으로는 포착하기 어려운 미션별 특수 고려사항이 점수에 반영됩니다.

#### 연구 기반 피드백 강화
RAG에서 받은 답변을 피드백 섹션에 추가합니다. "Research indicates: Excellent privacy configuration for long-duration Mars missions. Crew psychological well-being is well addressed."처럼 논문 근거가 있는 구체적 피드백을 제공하며, 하단에는 참조한 논문의 파일명과 페이지 번호를 명시하여 신뢰성을 확보합니다.

---

### 3. RAG 챗봇 - 논문 기반 질의응답

#### 사용자 질문 접수
사용자가 별도의 챗봇 인터페이스를 통해 자유롭게 질문할 수 있습니다. 예를 들어 "What is the minimum NHV for sleep quarters?" 또는 "How should noise-generating equipment be positioned?"처럼 논문 내용에 대한 구체적 질문이 가능합니다.

#### 의미 기반 검색
질문 텍스트를 동일한 임베딩 모델로 벡터로 변환한 후, 저장된 수백 개의 논문 청크 벡터들과 코사인 유사도를 계산합니다. 가장 유사도가 높은 상위 K개(기본 5개) 청크를 선택합니다. 예를 들어 "sleep quarters NHV" 질문에는 Stromgren 논문의 Table 16 근처 청크들이 높은 유사도로 검색될 것입니다.

#### 컨텍스트 기반 답변 생성
검색된 청크들의 텍스트와 출처 정보를 조합하여 LLM에 전달합니다. 프롬프트는 "당신은 우주 거주지 설계 전문가입니다"라는 역할 정의, 검색된 논문 내용("Source: Stromgren_2020.pdf (Page 15), Content: ..."), 사용자 질문, "3-4문장으로 간결하게 답변하세요"라는 제약으로 구성됩니다. LLM은 논문 컨텍스트를 기반으로 정확한 답변을 생성합니다.

#### 출처 포함 응답 반환
최종 응답에는 LLM이 생성한 답변 텍스트, 참조한 논문의 파일명과 페이지 번호 목록, 각 청크의 전체 텍스트와 유사도 점수가 포함됩니다. 사용자는 답변의 근거를 직접 확인할 수 있으며, 필요시 원본 논문의 해당 페이지를 찾아볼 수 있습니다.

---

## 데이터 활용의 전체 흐름

두 편의 NASA 논문은 세 가지 방식으로 활용됩니다. 첫째, Stromgren 논문의 Table 16 데이터는 데이터베이스에 정적으로 저장되어 모든 평가의 기준점이 됩니다. 둘째, Simon & Wilhite 논문의 평가 공식들은 Java 코드로 구현되어 Basic 모드의 핵심 알고리즘이 됩니다. 셋째, 두 논문 전체가 벡터 데이터베이스에 저장되어 Advanced 모드와 RAG 챗봇이 실시간으로 필요한 정보를 검색하고 활용할 수 있게 합니다.

이렇게 동일한 논문 데이터가 정적 기준, 구현된 알고리즘, 동적 검색 지식 베이스라는 세 가지 형태로 시스템 전반에 녹아들어, 과학적 근거가 확실하면서도 유연하게 확장 가능한 평가 시스템을 구축했습니다.
